#
# Executes commands at the start of an interactive session.
#
# Authors:
#   Sorin Ionescu <sorin.ionescu@gmail.com>
#

# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/.zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/.zprezto/init.zsh"
fi

# Customize to your needs...
alias ll='ls -l'
alias e='emacsclient -nw'

export VISUAL=emacsclient
export EDITOR=emacsclient

path=(
  /usr/local/opt/ncurses/bin(N-/)
  /usr/local/Cellar/openssl/1.0.2j/bin
  $HOME/Applications/homebrew/bin
  $HOME/Applications/homebrew/opt/coreutils/libexec/gnubin
  $HOME/.rbenv/bin
  $path
)

export HOMEBREW_CACHE=$HOME/Applications/homebrew/cache
export HOMEBREW_CASK_OPTS="--appdir=$HOME/Applications"

eval "$(rbenv init -)"
eval "$(nodenv init -)"
eval "$(direnv hook zsh)"

setopt nonomatch

rimraf() {
  echo "rm -rf $@ ??"
  read input

  if [ -z $input ] ; then
    echo "must type y or n"
    rimraf
  elif [ $input = 'yes' ] || [ $input = 'YES' ] || [ $input = 'y' ] ; then
    echo "rm -rf $@ ..."
  elif [ $input = 'no' ] || [ $input = 'NO' ] || [ $input = 'n' ] ; then
    echo "cancel"
    exit 1
  else
    echo "must type y or n"
    rimraf
  fi

  command rm -rf $@
}

peco-select-history() {
  local tac
  if which tac > /dev/null; then
    tac="tac"
  else
    tac="tail -r"
  fi
  BUFFER=`history -n 1 | tac  | awk '!a[$0]++' | peco`
  CURSOR=$#BUFFER
  zle reset-prompt
}

zle -N peco-select-history
bindkey '^r' peco-select-history
